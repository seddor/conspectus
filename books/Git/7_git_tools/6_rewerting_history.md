# Исправление истории

## Изменени послднего коммита

```bash
git commit --amend
```
>Вы должны быть осторожными, используя этот прием, так как при этом изменяется SHA-1 коммита. Поэтому как и с операцией rebase – не изменяйте ваш последний коммит, если вы уже отправили ее в общий репозиторий.

## Изменения сообщений нескольких коммитов

```bash
git rebase
```
* `-i <cursor>` — интерактивный режим ребейза, в `<cursor>` нужно укзать какие коммиты нужно изменить, можно использовать указатели наподбии `HEAD~3`. Изменит коммиты с HEAD~3 по HEAD.
В результате запустится скрипт, который отобразит изменяемые коммиты в порядке от старого до нового, начиная с того, который указан в параметре.
```
pick f7f3f6d changed my name a bit
pick 310154e updated README formatting and added blame
pick a5f4a0d added cat-file
```
Для коммиов можно применть такие опции:

* `pick` — неизменно использовать коммит.
* `reword` — использовать коммит, но изменить сообщение коммита.
* `edit` — остановится на коммите для редактирования, после редактирования нужно сделать:
```bash
git commit --amend
```
затем для продолжения ребейза:
```bash
git rebase --continue
```
* `squash` — используется для объединения коммитов, например если нужно из 3х коммитов сделать 1, то нужно сдлеать примерно так:
```
pick f7f3f6d changed my name a bit
squash 310154e updated README formatting and added blame
squash a5f4a0d added cat-file
```
после примения откроестся редактор для измения сообщения.

Если нужно изменить порядок коммитов или удалить коммит то нужно прямо в редактре переставить коммиты местами, а не нужные удалить из списка.

## filter-branch

### Удаление файла из каждого коммита

```bash
git filter-branch --tree-filter 'rm -f password.txt' HEAD
```
* `--tree-filter` выполняет указаную команду после переключения на каждый коммит и затем повторно фиксирует резултат.
* `--all` — выполнит `filter-branch` на всех ветках

### Установка поддиректории корневой директории проекта

```bash
git filter-branch --subdirectory-filter trunk HEAD
```
Изменит корневую директорию проекта на `trunk`.

### Глобадбное измения адреса почты

```bash
git filter-branch --commit-filter '
      if [ "$GIT_AUTHOR_EMAIL" = "schacon@localhost" ];
      then
              GIT_AUTHOR_NAME="Scott Chacon";
              GIT_AUTHOR_EMAIL="schacon@example.com";
              git commit-tree "$@";
      else
              git commit-tree "$@";
      fi' HEAD
```
