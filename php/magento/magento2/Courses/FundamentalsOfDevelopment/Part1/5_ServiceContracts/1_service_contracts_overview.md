# Сервисные контракты

Сервисные контракты одна из важных концепций включенных в M2. 

Сервисные контракты выполняют ряд выжных функций, таких как:

* Улучшение процесса обновления
* Формализация кастомизации
* Уменьшения связаности модулей

## Улучшение процесса обновления

В основном, сервисные контакты представляяют из себя набор публичных классов и интерфейсов, которые доступны для использования при создании кастомного модуля или при кастомизации модулей ядра.

Сервисный слой используется для кастомизации без необходимости глубоко понимания внутренего устройсва кода продукта. 

### Public API code base

Public API code base — набор классов и интрефейсов, с php-аннотацией `@api`. Как только класс/интерфейс помечается аннотацией `@api`, он становится неизменным для дальнейшей модификации в будущем. Например класс [`Magento\Customer\Model\Address`](https://github.com/magento/magento2/blob/2.3/app/code/Magento/Customer/Model/Address.php) является публичных API начиная с версии 100.0.2 (версия указывается в аннотации `@since`). Это значит, что можно расчитывать на неизменность функционала этого класса/интерфейса в будущем, и использовать его для своего модуля.

Т.к. классы с аннотацией `@api` не изменяются, при их использовании не должно возникать проблем с последующими обновлениями модулей в которых содержат этот API.

## Формализация кастомизации

Также сервисные контракты призваны упростить и формализировать процесс кастомизации. 

Кастомизация с использование сервисных контрактов подразумевает, что разработчик полагается только на классы и интерфейсы с аннотацией `@api`.

## Уменьшения связаности моделей

В M2:

* Модули взаимодействуют только через API
* Один модуль не знает о внутренем устройстве другого, поэтому внутренняя реализация может изменятся
* Модули могут быть раскатаны на отдельных серверах

## API подход для реализации сервисных контрактов

Все операции модуля делятся на две группы:

* Data API — предоставляет доступ к данным сущностей модуля. Распологается в _`<module_dir>`/Api/Data_
* Operational API — отвечает за бизнес операции выполяемые модулем. Часто включает в себя публичные методы моделей и хелперов. Распологается в _`<module_dir>`/Api_ (кроме поддиректории _Data_)

## Плюсы

Плюсы использования сервисного подхода:

* Возможность полагаеться на публичные API, а не на реализацию
* Уменьшенная связаность
* Минимизация конфликтов
* Возможность полагаться на интерфейс, а не на реализацию

## Минусы

* Более сложно выполянть низкоуровневые настройки
* Реализация иногда может иметь значение
* Сложнее дебажить
* Последующие измения должны быть совместимы с публичным API
