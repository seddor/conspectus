# Ansible

Ansible — ситема управления конфигурациями, позволяет автоматизировать настройку и развёртывания ПО.

## Ad-Hoc

У ansible есть несколько режимов работы, самый простой из них — ad-hoc, когда запрос к серверу выполняется напрямую из командной строки, без создания дополнительных файлов.

```bash
# Проверяет доступность сервера по ip-адресу
# all – запрос выполняется для всех указанных машин
# 157.230.82.133 – ip-адрес моей машины. В вашем случае будет другой
# запятая в конце не ошибка, так нужно для работы Ansible
# root – пользователь для подключения по ssh
# ping – используемая команда (модуль ansible)
ansible all -i '157.230.82.133, ' -u root -m ping
```

В примере выше происходит подключение по ssh к удалённому серверу и выполнение команды `ping`, в ansible за запуск этой команды отвечает отдельный модуль `ping`, модули в Ansbile выполняют команды на удалённых машинах. Один из модулей — `command` позволяет запускать произвольную команду на сервере.

```bash
# Модуль command запускает на удаленной машине команду uptime
# -a – означает аргумент. В случае модуля command это то, что запустится на удаленной машине
ansible all -i '157.230.82.133, ' -u root -m command -a 'uptime'
157.230.82.133 | CHANGED | rc=0 >>
 06:12:48 up 11 days, 21:53,  1 user,  load average: 0.04, 0.04, 0.01
```

## Файл инвентаризации

В ansible есть специальный файл инвентаризации, который описывает инфраструктуру, в этом файле можно указывать адреса серверов:

```ini
157.230.82.133
# Именем может быть имя домена, что удобнее
# имена понятнее и не завязаны на ip-адрес, который может поменяться
ec2-3-17-186-111.us-east-2.compute.amazonaws.com
# тут другой адрес
# тут еще один
```

Файл имеет расширение `.ini`, однако у него нет строго заданного имени. Запуск ansible с файлом инвентаризации:

```bash
# -i – означает inventory, all — для всех серверов
ansible all -i inventory.ini -u root -m ping
```

Ansible выполняет команды к серверам параллельно, при этом ошибка выполнения команды на одном сервере не ведёт к остановке команды, после выполнения ansible покажет на каких серверах команды запустилась удачно, а на каких нет.