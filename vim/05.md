# Глава 5

## Режим командной строки

Режим командной строки и его команды ещё называют ex, это название пошло от редактора предком которого является vim. 

`:` — переход в режим командной строки

`:[range]delete[x]`/`[range]d[x]` — удалит указанные строки [в регистр x]

`:[range]yank[x]`/`[range]y[x]` — скопирует указанные строки [в регистр x]

`:[line]put[x]`/`[range]p[x]`  — вставит текст из регистра x после указнной строки

`:[range]join` — объеденит указанные строки

`:[range]subtitute/{patternt}/{string}/[flags]` — заменит вхождения `{pattertn}` последовательностью символов `{string}` в каждой указанной строке

`:[range]global/{pattern}/[cmd]` — выполнит команду `[cmd]` для всех строк из указанных, где найдено вхождение `{pattern}`

`:write` — сохранить текущий файл

`:{line}` — переход с строке с номером `{line}`, для перехода к последней строке можно использовать `$` в качестве номера строки.

### [range]

Большинство из команд командной строки могут начинаться с префикса  `[range]` — это диапазон действия. В нём указываются номера строк/строки, чтобы указать несколько строк: `{start},{end}`. Например, с 2 по 4 строки будет: `2,4`

В качестве адреса строки можно использовать не только цифры, но и специальные символы:

* `$` — последняя строка
* `.` — текущая строка
* `%`  — все строки текущего файла
* `0` —  начало файла

Так-же можно указывать в качестве диапазона визуальное выделение для это нужно выделить нужный фрагмент и нажать `:`, это приведёт переходу в режим командной строки где в качестве `[range]` будет указан выделенный диапазон.

Можно использовать регулярки для обозначения диапазона, для этого нужно заключить регулярку в `//`, например:

```
:/<html>/,/<\html>/
```

указывает на диапазон между тегами `<html>`.

В диапазоне можно указывать смещение, например если нужно выполнить команду для для всех строк внутри `<html></html>`, то можно указать диапазон:

```
:/<html>/+1,/<\html>/-1
```

или диапазон  3 строки относительно текущей строки:

```
.,.+3
```

### Копирование и перемещение

`:[range]copy{address}`/`[range]t{address}` — скопирует указанные строки ниже строки с номером `{address}`

`:[range]move{address}`/`[range]m{address}` — переместит указанные строки ниже строки с номером `{address}`

### Применение команд к диапазону строк

`:[range]normal{commands}` — выполнит команду {commands}, командного режима для каждой указанной строки

Чтобы проставить в конце каждой строки `;` можно использовать команду:

```
:$normal A;
```

### Повторение последней команды ex

`@:` —  повторит последнюю команду.

### Автодополнение

В режиме ex работает автодополнение, его можно взывать клавишей `tab`, а комбинация клавиш `cntrl+d` выведет список доступных вариантов.

### Вставка текущего слова в командную строку

`cntrl+r+w` — (в режиме ex) вставит слово находящееся под курсором в командную строку

### Повторный вызов команд из истории

Vim записывает выполненные команды ex, затем их можно получить используя стрелочки в режиме ex или введя номер команды.

Если ввести какое-то символы в режиме ex и попробовать переключить команду стрелочкой, то будет найдены команды в истории начинающееся с этих символов.

По умолчанию vim записывает последние 20 команд, изменить это количество можно в _vimrc_:

```
set history=200
```

История сохраняется для всех сессий и не прерывается при закрытии редактора.

Также запоминается история поисков через `/` её можно переключать так же как историю команд ex.

`q:` —  открыть окно истории режима командной строки, в нём можно переключать команды стрелками или с помощью `k`,`j`. Для выполнение команды нужно нажать `enter`, после выполнения команды окно закрывается, чтобы выйти без применения нужно использовать `:q`.

`q/` — открыть окно истории поиска

### Выполнение внешних команд

`:!{command}` — выполнит внешнюю команду `{command}`. Для выполнение внешней команды для текущего файла можно использовать `%`:

```
:!ruby %
```

`:shell` — запускает сеанс терминала, `exit` возвращает обратно в vim

`:read !{cmd}` — сохранит в буфер вывод команды `{cmd}`

`:write !{cmd}` — передаст содержимое буфера на ввод команде `{cmd}`

`[range]!{cmd}` — при указании диапазона vim берёт содержимое диапазона в качестве входного аргумента `{cmd}` а затем заменяет содержимое диапазона на вывод команды, например:

```
:2,$!sort -t',' -k
```

выполнит сортировку для диапазона со второй строки по последнюю.
