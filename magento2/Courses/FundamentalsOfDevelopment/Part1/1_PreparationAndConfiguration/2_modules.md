# Модули

Модуль обычно это пакет, содержащий код инкапсулирующий опередлённую бизес фичу или набор фич.

* Модуль логическая группа — директория содержащая .php и .xml файлы связанные с определённой функциональностью.
* Использование модульного подхода подразумевает, что каждый модуль инкаспулирует фичу и имет минимальное количество зависимостей от других модулей.

## Местонахождение

распологаются в:

* `app/code/<vendor>/<module_name>/`
* `vendor/<vendor-composer-namespace>/<module_name>/`

## Именование

Имя модуля, как и в M1, состоит из двух частей разделённых `_` Namespace_Module

* Namespace или Vendor — соответствует имени поставщика модуля
* Module — название самого модуля

## Регистрация модуля

* Технически модуль это директория в _app/code/<vendorName>_ или _vendor/<vendorName>_ содержащая несколько обязательных файлов, таких как `etc/module.xml` и `registration.php`

### etc/module.xml

Файл содержит основную информацию о модуле:
```xml
<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Module/etc/module.xsd">
    <module name="Exam_Test" setup_version="1.0.0">
        <sequence>
            <module name="Magento_Catalog"/>
        </sequence>
    </module>
</config>
```

* name — имя модуля
* setup_version — версия (не обязательно если используется декларативная схема)
* sequence — здесь указываются зависимости модуля

### registration.php

Технический файл необходимый для регистрации модуля в системе:
```php
<?php

\Magento\Framework\Component\ComponentRegistrar::register(
    \Magento\Framework\Component\ComponentRegistrar::MODULE,
    'Exam_Test',
    __DIR__
);
```

## Зависимости модулей

В M2 модули это логические группы, каждая из которых отвечает за раздельные функции, под этим подразумевается:

* Несколько модлей не могут выполнять одну фичу
* Один модуль не может выполнять несколько фич
* Если нужно модуль явно указывает зависимость от другого модуля
* Другие зависимости от компонентов (например, тем) тоже нужно объявлять
* Удаление или отключение модулей не должно приводить к отключению других модулей

### Типы зависимотей

#### Сильная

Модуль не может работать без другого, такие модули:
* Содержат код использующий логику из другого модуля: константы классов, статичные методы, публичные поля классов, интерфейсы и трейты
* Содержат строки включающие имена классов, интерфейсов, методов, трейтов другого модуля
* Используют объекты из другого модуля
* Используют или изменяют таблицы БД используемые в другом модуле

Для таких модулей стоит явно прописывать зависимость в `composer.json` файле модуля в секции `require`:


```json
 ...
  "require": {
    "magento/module-catalog": "103.0.*",
    "magento/module-email": "101.0.*",
    "magento/module-media-storage": "100.3.*",
    "magento/module-store": "101.0.*",
    "magento/module-theme": "101.0.*",
    "magento/module-ui": "101.1.*",
    "magento/module-variable": "100.3.*",
    "magento/module-widget": "101.1.*",
    "magento/module-authorization": "100.3.*"
   },
   ...
```

#### Слабая 

Модуль в принципе может работать без другого, в таких модулях:
* Непосредственно проверяет доступность другого модуля
* Расширяет конфигурации другого модуля
* Расширяет лаяут другого модуля

Такие модули нужно объявлять в файле `etc/module.xml` в ноде `sequence`:

```xml
  <module name="Magento_Cms">
     <sequence>
        <module name="Magento_Store"/>
        <module name="Magento_Theme"/>
        <module name="Magento_Variable"/>
     </sequence>
  </module>
```

Так-же `sequence` можно использовать для определения порядка загрузки модулей.
