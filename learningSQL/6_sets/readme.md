# Работа с множествами

При работе с множествами с таблицами нужно соблюдать некторые правила:

* Обе таблицы должны иметь одинаковое количество столбцов
* Типы данных в толбцах должны совпадать или СУБД должна уметь преобразовывать одни данные в другие.

## Операторы

SQL включает в себя 3 оператора для работы с подмножествами(объединене, пересечение, разность), при этом каждый оператор ещё имеет по две разновидности: с ключением дублирующих данных и с без них(при этом убираются не обязатльно все дубликаты).

### Union

`Union` и `union all` позволяет комбинировать несколько таблиц. 
* `union all` — объединяет две таблицы, включая в результат **все** их строки, включая дублирующие значения. В результате будет столько строк, сколько во всех исходных таблицах в сумме:
```SQL
SELECT cust_id, lname name
    FROM individual
    UNION ALL
    SELECT cust_id, name
    FROM business;
```
* `union` — тоже самое, но SQL-сервер проверяет резльтат на дубликаты и удаляет их из выборки

### Intersect

intersect — пересечение, в результат попадают пересекающиеся значения, как в других операторов множест предполагается `all`-версия и с удалением друбликатов.

>оператор отсутвует в Mysql

### Expect

expect — разность, выбирает уникальные значеня возвращаемые запросом слева от `expect`, но отсутвующие в результатах запроса справа.

>оператор отсутвует в Mysql

Разность `all` версии, что она удалит из выборки столько дубликатов из левого множества, сколько их встретит в правом, например:

Множество A:
|id|
|-|
|10|
|11|
|12|
|10|
|10|

Множество B:
|id|
|-|
|10|
|10|

`A excpect B`:
|id|
|-|
|11|
|12|

`A excpect all B`:
|id|
|-|
|10|
|11|
|12|

## Правила операций с множествами

### Результаты сортирующего запроса

Если нужно отсортировать результаты запросов, то нужно добавть `order by` и укзать в нём имя столбца из первой таблицы, иначе будет ошбика, или можно дать именам столбцов одинаковые элиасы:
```SQL
SELECT emp_id, assigned_branch_id
    FROM employee
    WHERE title = 'Teller'
    UNION
    SELECT open_emp_id, open_branch_id
    FROM account
    WHERE product_cd = 'SAV'
    ORDER BY emp_id;
```

### Приоритеты операций

В общем случае порядок оценивается сверху вниз, но с учётом:
* По спеке SQL из всех операторов первым выполняется `intersect`.
* Порядок можно изменять с помощью скобок

>Однако, в случае с MySQL ни intersect, ни скобки для операторов множества в нём недоступны.
